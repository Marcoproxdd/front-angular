<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Apuestas</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
        }

        .table-container {
            margin-top: 30px;
        }

        .bet-details {
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .bet-details h4 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .bet-details p {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .loading-spinner {
            display: block;
            margin: 20px auto;
        }

        .table th,
        .table td {
            vertical-align: middle;
        }

        .table-hover tbody tr:hover {
            background-color: #f1f1f1;
        }

        .table-striped tbody tr:nth-child(odd) {
            background-color: #f9f9f9;
        }
    </style>
</head>

<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Historial de Apuestas</h1>

        <!-- Mensaje de carga -->
        <div id="loadingMessage" class="text-center">
            <div class="spinner-border loading-spinner" role="status">
                <span class="sr-only">Cargando...</span>
            </div>
            <p>Cargando apuestas...</p>
        </div>

        <!-- Tabla para mostrar las apuestas -->
        <div class="table-container">
            <table id="betsTable" class="table table-striped table-bordered table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>Evento</th>
                        <th>Resultado</th>
                        <th>Cuota</th>
                        <th>Monto Apostado</th>
                        <th>Ganancia Potencial</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Las apuestas se cargarán aquí dinámicamente -->
                </tbody>
            </table>
        </div>

        <!-- Detalles de la apuesta seleccionada -->
        <div class="bet-details">
            <h4>Detalles de la Apuesta</h4>
            <p id="betDetails">Selecciona una apuesta de la tabla para ver más detalles aquí.</p>
        </div>
    </div>

    <script>
        const userId = "6760501871ad46cb6c5a514f"; // Ejemplo de ID de usuario
        const API_BASE = 'http://localhost:3008/v1/api';

        // Función para cargar las apuestas del usuario
        async function loadUserBets() {
            try {
                document.getElementById('loadingMessage').style.display = 'block'; // Mostrar mensaje de carga
                const response = await fetch(`${API_BASE}/bets/${userId}`);
                const data = await response.json();

                if (Array.isArray(data.data)) {
                    displayBets(data.data);
                } else {
                    console.error('Error: No se encontraron apuestas.');
                    showErrorMessage('No se encontraron apuestas.');
                }
            } catch (error) {
                console.error('Error al cargar las apuestas:', error);
                showErrorMessage('Hubo un problema al cargar las apuestas.');
            } finally {
                document.getElementById('loadingMessage').style.display = 'none'; // Ocultar mensaje de carga
            }
        }

        // Función para mostrar un mensaje de error
        function showErrorMessage(message) {
            const betDetails = document.getElementById('betDetails');
            betDetails.innerHTML = `<strong class="text-danger">${message}</strong>`;
        }

        // Mostrar las apuestas en la tabla
        function displayBets(bets) {
            const tbody = document.querySelector('#betsTable tbody');
            tbody.innerHTML = ''; // Limpiar la tabla

            bets.forEach(bet => {
                // Asegurarse de que `sportEventName` esté presente, si no, mostrar "Evento desconocido"
                const eventName = bet.sportEventName ? bet.sportEventName : 'Evento desconocido';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${eventName}</td>
                    <td>${bet.selectedOutcome || 'Resultado desconocido'}</td>
                    <td>${bet.odds || 'N/A'}</td>
                    <td>${bet.amount || '0'}</td>
                    <td>${bet.potentialWinnings || '0'}</td>
                `;
                row.addEventListener('click', () => showBetDetails(bet)); // Mostrar detalles al hacer clic
                tbody.appendChild(row);
            });
        }

        // Mostrar los detalles de una apuesta seleccionada
        function showBetDetails(bet) {
            const betDetails = document.getElementById('betDetails');
            betDetails.innerHTML = `
                <strong>Evento:</strong> ${bet.sportEventName || 'Desconocido'}<br>
                <strong>Resultado:</strong> ${bet.selectedOutcome || 'Desconocido'}<br>
                <strong>Cuota:</strong> ${bet.odds || 'N/A'}<br>
                <strong>Monto Apostado:</strong> ${bet.amount || '0'}<br>
                <strong>Ganancia Potencial:</strong> ${bet.potentialWinnings || '0'}
            `;
        }

        // Cargar las apuestas al cargar la página
        document.addEventListener('DOMContentLoaded', loadUserBets);
    </script>
</body>

</html>
